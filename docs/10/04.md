---
lang: zh-CN
title: Section 10.4 System Time Configuration
description: some description
---

As you study this section, answer the following questions:

<ul><li>How can you view the current hardware clock time?</li>
<li>What is drift?</li>
<li>How do you synchronize time on a Linux network?</li>
<li>How does stratum help to provide accurate time?</li>
<li>What is the difference between stepping and slewing?</li></ul>

In this section, you will learn to:

<ul><li>Configure time zone settings</li>
<li>Manage system time</li>
<li>Synchronize time with NTP</li></ul>

Key terms for this section include the following:

<table class="terms">
<thead>
  <tr>
    <th>Term</th>
    <th>Definition</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>Hardware clock</td>
    <td>
      A chip on the system's motherboard used to set the system's time.
    </td>
  </tr>
  <tr>
    <td>System time</td>
    <td>
      Software running within the operating system which is used to set
      and keep the system's time.
    </td>
  </tr>
  <tr>
    <td>
      Coordinated Universal Time
      <br />
      (UTC)
    </td>
    <td>
      The primary time standard by which the world regulates clocks and
      time.
    </td>
  </tr>
  <tr>
    <td>UTC offset</td>
    <td>
      The amount of time that local time is ahead of or behind Coordinated
      Universal Time (UTC).
    </td>
  </tr>
</tbody>
</table>

This section helps you prepare for the following certification exam objectives:

<table class="objectives">
<thead>
  <tr>
    <th>Exam</th>
    <th>Objective</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>CompTIA Linux+ XK0-005</td>
    <td>
      1.7 Given a scenario, manage software configurations.
      <ul>
        <li>
          Configure common system services
          <ul>
            <li>Network Time Protocol (NTP)</li>
            <li>chrony</li>
          </ul>
        </li>
        <li>
          Localization
          <ul>
            <li>timedatectl</li>
          </ul>
        </li>
      </ul>
      <p>
        4.5 Given a scenario, use systemd to diagnose and resolve common
        problems with a Linux system.
      </p>
      <ul>
        <li>
          Common problems
          <ul>
            <li>Time-zone configuration</li>
          </ul>
        </li>
      </ul>
    </td>
  </tr>
</tbody>
</table>

## 10.4.1 Time Zone Settings

Click one of the buttons to take you to that part of the video.

Time Zone Settings 00:00-00:25
If a Linux system is moved to a different physical location, you may need to reconfigure your time zone settings depending on how far you move the system. At first glance, this might seem like a trivial task. Time on a Linux system is managed differently than on other operating systems you might be familiar with. In this lesson, we'll review how time works on Linux, and then we'll talk about configuring the time zone.

View Linux Clocks 00:25-00:30
There are two clocks that you need to be concerned with on a Linux system.

Hardware Clock 00:30-00:53
The first is the hardware clock which runs all the time—even when the system is powered off. It runs on a chip on your motherboard, and a battery keeps it going. Sometimes it's referred to as the RTC, which stands for real-time clock. You might even hear it referred to as the BIOS clock.

You can manage the time and date of the hardware clock on your motherboard using the hwclock command at the shell prompt.

System Clock 00:53-01:53
The second clock is the Linux software system time, which is inside the Linux kernel itself.

At boot time, the system time is synchronized to the hardware clock time. After the system has been booted, Linux refers only to system time. The hardware clock at that point is ignored until the next time the system is rebooted.

System time is measured as the number of seconds that've passed since midnight, January 1st, 1970, UTC, or Universal Time Coordinated—the time in Greenwich, England. UTC is often referred to as Greenwich Mean Time, or GMT. UTC is the standard by which the world regulates time so that everything stays in sync. Your local time is then determined by either adding or subtracting one hour to or from UTC for each time zone that you're away from Greenwich, England.

Keep in mind the hardware clock and the system time on the Linux system may not actually be the same. When you're managing a Linux system, you need to be focused on the system's time.

Linux Time Options 01:53-03:09
When setting the time on your hardware clock, you've got two options to choose from—the first one's UTC. The Linux kernel will automatically calculate your time offset, including daylight saving time, if applicable, for your local time zone to come up with the local time. The other option is to set it to the local time.

So, which one is best? When installing Linux, you'll probably be prompted to specify which way your local clock's set. You've got to choose between "I have my clock set to UTC" or "I have my clock set to local time."

Setting your hardware clock to UTC is the preferred option when working with Linux systems. Using UTC makes calculating your time zone differences simpler. For example, suppose you install a groupware application on your Linux system that manages email, instant messaging, and so on across multiple time zones.

When you do this, you should set your hardware clock to UTC. Doing this makes it easier for the groupware application to coordinate timestamps assigned to messages for all the different computers using that system. If you don't use UTC, then it's possible you could get messages timestamped from 4:00 in the morning when they really weren't sent at 4:00 in the morning. Using UTC, the timestamps will be consistent through all time zones.

Configuring Time Zone 03:09-04:02
Let's talk about configuring the time zone on a Linux system. During the initial installation of your Linux system, you'll be prompted to specify which time zone the system is located. Where that's saved depends on the distribution.

If you're using a Debian-based distribution, such as Ubuntu, the time zone you specify is saved in this file: /etc/timezone. An example's shown here, where we use the cat command to view the file contents. It tells me I'm in the America/Denver time zone, which is UTC -7.

RPM-based distributions, such as Fedora, Red Hat, OpenSUSE, and so on, will save this information in a different file—in /etc/sysconfig/clock. Notice the syntax here says TIMEZONE= and then the time zone's name, which in this case says "America/Boise," which's exactly the same time zone as America/Denver—UTC -7.

View the Current Time Zone 04:02-04:13
You can view the current time zone setting by entering the date command at the shell prompt. In this example, you can see that my time zone's set to MDT, which stands for Mountain Daylight Time, which again is UTC -7.

Change the Time Zone 04:13-05:04
If you need to change the time zone setting on a Linux system after it's initially installed, you can use one of two different commands. For Debian distributions, you use the tzconfig command. Other distributions, like Fedora, Red Hat, openSUSE, and so on, use the tzselect command.

Here's what it looks like when you run the tzselect command. You'll first need to enter the appropriate number for the desired region. For example, if my time zone is in North America, I'd enter "2" and then specify "Americas." Then I'd select the country where the system is located and the appropriate time zone.

I've specified that I'm in the United States and want to use Mountain Time. It tells me that the Time Zone Environment Variable, TZ, will be set to America/Denver, and I need to confirm by entering "1" and selecting "Yes."

Change the Time Zone Environment Variable 05:04-06:08
Because TZ basically sets the value of the TZ environment variable, you don't have to use it. You can change time zones from the shell prompt without using the tzselect command by simply setting the value of the TZ environment variable and then exporting it. This can be useful in situations where you don't have access to the root account for the system.

Here's the syntax for doing this. We enter "TZ=," followed by the name of the time zone file we want to use. A list of all the available time zones can be found in the directory shown here. After setting the value of the environment variable, you'd export it.

In this example, I've done both at once. I run export, and then I set the value of the TZ environment variable all in one command. As with any other environment variable, this change isn't persistent.

If I were to reboot the system, my time zone change would be lost. If we want to make it persistent for just my user account, I could open up the .profile hidden file in my user's /home directory and enter the command here.

Change Time Zones in /etc/localtime 06:08-07:03
There's one last way we can change the time zones we want to look at, and that's by using the /etc/localtime file.

This file is a symbolic link pointing to the appropriate zone file in the /usr/share/zoneinfo directory.

If I want to switch my time zone to Mountain Standard Time in the United States, I use the ln command to create a symbolic link, and I use the -sf option, followed by the zone file—the time zone file I want to point to.

In this case, it's the Boise time zone file in /usr/share/zoneinfo/America. Then, I specify the name of the symbolic link I'm creating, which is /etc/localtime. Using the ls –l command to view this file, we can see that it points to the appropriate zone file in /usr/share/zoneinfo.

Summary 07:03-07:15
That's it for this lesson. In this lesson, we've discussed how time is tracked on Linux and how to manage Linux time zones.

## 10.4.2 Configuring Time Zone Settings

Click one of the buttons to take you to that part of the video.

Configure Time Zone Settings 00:00-00:25
In this demonstration, we're going to discuss configuring time zone settings. When I initially installed Linux on this system, I was prompted to specify my time zone, and that's the time zone setting currently being used. However, if I were to move this computer to a different location in the country or somewhere else in the world, it's very likely I'd have to update the current time zone.

View Current Time Zone 00:25-00:50
There are several ways you can view the current time zone setting. One method is to use the date command. From its output, you not only see the current date and time, but you also see the time zone.

MDT means the time zone for this system is the Mountain Time zone. Another method is to use the timedatectl command. This shows you the same information as with the date command, but includes a lot more, too.

View Available Time Zones 00:50-02:09
Let's suppose I've now moved this system to the state of Virginia. Since Virginia is in the east coast of the United States, I now need to switch my time zone to the Eastern Time zone. This can be done using a variety of methods.

For example, if you are on an older system, you can change the time zone by symbolically linking /etc/localtime to the time zone in the /usr/share/zoneinfo directory. However, since most modern distributions of Linux now include the timedatectl command that we used earlier to view the current time zone information, we can use it to update the time zone as well.

Before you can change the time zone, you'll first need to know the name of the time zone you want to switch to. One method of doing that is to run timedatectl list-timezones. As you can see, this displays an alphabetical list of all the available time zones in a variety of ways. For example, when I move down to the Americas, you see options for various cities such as New York.

Or, when I move to the end of the list, you see I can specify a time zone based on the region of the United States. So, in this scenario, since my computer has been moved to Virginia, I would want to use the US/Eastern time zone. Regardless of which option you choose, make sure you note the proper syntax shown.

Change the Time Zone 02:09-02:38
To change the time zone, all we need to do now is to run the timedatectl command with the set-timezone option and then specify the applicable time zone. For example, to change to the time zone for Virginia, I could use America/New_York because there wasn't an America option specifically for Virginia, or I can use US/Eastern. Let's use that option. Now to see the change, we can run timedatectl, and we see that this system is now using the Eastern time zone.

Summary 02:38-02:59
And that's it for this demonstration. In this demonstration, we talked about configuring time zone settings. We first showed you how to view your current time zone. Next, we showed you how to find the available time zone values. And we finished this demonstration showing how to change your computer to a new time zone.

## 10.4.3 Time Zone Facts

A time zone is a geographic region of the world that has the same standard time.

This lesson covers the following topics:

<ul><li>General considerations</li>
<li>Linux clocks</li>
<li>UTC offset</li>
<li>Time zone tools and files</li></ul>

### General Considerations

When dealing with time zones, be aware of the following details:

<ul><li>The time zone ensures that daylight hours fall within a certain time
        period, regardless of the area of the world.</li>
   <li>In many areas, daylight saving time (DST) moves clocks ahead by one
        hour from the standard time zone time during "summer" when there are
        more daylight hours. Not all locations observe daylight saving time. For
        example, areas along the equator typically do not because the number of
        daylight hours does not vary significantly throughout the year.</li>
   <li>The local time is the time used in your physical location, adjusting
        for the time zone and daylight saving time (if used).</li>
<li>As you change your physical location, the local time can also change
based on the time zone used in that area.</li>
<li>Time zone names used in the United States (Eastern, Central, Mountain,
Pacific) are not part of the official time zone standards but are useful
in comparing time between different parts of the country. In the United
States, the time zone names can also reflect whether or not daylight
time is in effect.
<ul><li>Eastern Daylight Time (EDT) identifies the Eastern time zone,
observing daylight standard time.</li>
<li>Mountain Standard Time (MST) identifies the Mountain time zone,
not observing daylight standard time.</li></ul></li></ul>

### Linux Clocks

Linux systems keep time using two clocks:

<table><thead><tr><th class_="firstTableHeader" scope="col" class="fw-bold">
     Clock</th>
    <th scope="col" class="fw-bold">
     Description</th></tr></thead>
   <tbody><tr><td>Hardware clock</td>
     <td>The hardware clock keeps time using a chip on the
            system's motherboard.
      <ul><li>The hardware clock runs independently of any software. The
                clock does not require access to the CPU or system RAM to run.</li>
       <li>Soft power from the power supply and the CMOS battery ensures
                that the clock continues to run when the computer is turned off
                or even unplugged.</li>
       <li>The hardware clock is sometimes called the real-time clock
                (RTC), BIOS clock, CMOS clock, or time of year (TOY) clock.</li>
       <li>The current hardware clock time is stored in the <b class="fw-bold">/proc/driver/rtc</b> file.</li></ul></td></tr>
    <tr><td>System time</td>
     <td>System time keeps time using software running
            within the operating system.
      <ul><li>Time on the system clock is measured as the number of seconds
                that have elapsed since 12:00 AM on Jan 1, 1970.</li>
       <li>By default, when the computer boots, it initially sets the
                system time using the current time from the hardware clock.</li>
       <li>After the operating system is running, the system time is the
                only clock used by applications and services. The hardware clock
                is ignored.</li>
       <li>Changing the system time does not automatically change the
                hardware clock, although you can change the system time and
                change the hardware clock to match.</li></ul></td></tr></tbody></table>

### UTC Offset

Clocks on a Linux computer can use local time or UTC time. The following table describes these and explains how to calculate a UTC offset:

<table>
<thead>
  <tr>
    <th>Time</th>
    <th>Description</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>Coordinated Universal Time (UTC)</td>
    <td>
      Coordinated Universal Time (UTC), formerly known as Greenwich Mean
      Time (GMT), is a method of identifying a common time between devices
      regardless of their physical location in the world.
      <ul>
        <li>
          UTC is adjusted periodically to match the rotation of the earth
          by adding leap seconds. Leap seconds are required because the
          official duration of a second does not exactly match the earth's
          rotation (but it is very close).
        </li>
        <li>
          UTC matches time to the rotation of the earth using a single
          fixed point in Greenwich, England. A line drawn from the North
          Pole to the South Pole that passes through Greenwich is called
          the prime meridian.
        </li>
        <li>
          It is preferable for Linux systems to use UTC (not local time).
          This ensures that a single method of keeping time is used,
          regardless of the physical location of the computer. It also
          ensures that timestamps on files, within logs, and on database
          records remain consistent, especially on networks with hosts
          residing in multiple time zones.
        </li>
        <li>
          Time expressed using UTC is identified by adding UTC or Z to the
          time. For example, 09:30 UTC is the same as 09:30Z or 0930Z. UTC
          is also called Zulu time.
        </li>
      </ul>
    </td>
  </tr>
  <tr>
    <td>UTC offset</td>
    <td>
      The UTC offset identifies the amount of time that local time is
      ahead of or behind Coordinated Universal Time (UTC).
      <ul>
        <li>
          Local time in each time zone is identified by the UTC offset.
          For example:
          <ul>
            <li>
              Time zones used in the United States are UTC-05 (Eastern),
              UTC-06 (Central), UTC-07 (Mountain), and UTC-08 (Pacific),
              with time being behind UTC.
            </li>
            <li>
              Time zones used in Europe and Asia are ahead of UTC. For
              example, time in Germany is UTC+01, and time in Japan is
              UTC+09.
            </li>
          </ul>
        </li>
        <li>
          To convert UTC to local time, add time based on the UTC offset
          (UTC + offset). For example, if UTC is 06:00:
          <ul>
            <li>
              Local time in New York (UTC-05) would be 01:00 (06:00 + -
              5:00 = 1:00 AM).
            </li>
            <li>
              Local time in Los Angeles (UTC-08) would be 22:00 the
              previous day (10:00 PM).
            </li>
            <li>
              Local time in Japan (UTC+09) would be 15:00 (3:00 PM).
            </li>
          </ul>
        </li>
        <li>
          To convert local time to UTC, subtract time based on the UTC
          offset (UTC - offset). For example:
          <ul>
            <li>
              If the local time in New York (UTC-05) is 14:00, UTC is
              19:00 (14:00 - - 5:00 = 14:00 + 5:00).
            </li>
            <li>
              If the local time in Japan (UTC+09) is 14:00, UTC is 5:00
              (14:00 - + 9:00).
            </li>
          </ul>
        </li>
        <li>
          UTC does not change for daylight saving time; however, the
          offset used by a time zone will change. During daylight saving
          time, add one hour to the UTC offset. For example:
          <ul>
            <li>
              Standard time in New York is UTC-05; daylight time in New
              York is UTC-04.
            </li>
            <li>
              Standard time in Germany is UTC+01; daylight time in Germany
              is UTC+02.
            </li>
          </ul>
        </li>
      </ul>
    </td>
  </tr>
  <tr>
    <td>Local time</td>
    <td>
      Local time is the current time in a local time zone. It is
      designated using the number of hours ahead or behind UTC time. For
      example, the local time for the Mountain Time Zone in the United
      States is UTC -7. The default setting for several hardware clocks in
      a system BIOS is often local time.
    </td>
  </tr>
</tbody>
</table>

### Time Zone Tools and Files

The following table describes the tools and files used to determine and change time zone settings:

<table>
<thead>
  <tr>
    <th>Item</th>
    <th>Description</th>
    <th>Examples</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td><b>/usr/share/zoneinfo</b></td>
    <td>
      Contains time zone configuration files and directories, with each
      file identifying a specific time zone.
      <ul>
        <li>
          Files are typically organized in subfolders based on the
          continent (such as Australia) or major country (such as the US).
        </li>
        <li>
          Individual files identify a major city in the time zone (such as
          Perth) or a specific region (either a division of the country or
          a country within the continent).
        </li>
        <li>
          Information in the file identifies the UTC offset and any rules
          for daylight saving time.
        </li>
      </ul>
      <div>
        <div>
          <div>
            <div class="to-icon large" aria-hidden="true" style="width: 20px">
              <svg aria-hidden="true" focusable="false" data-prefix="fal" data-icon="circle-info" class="svg-inline--fa fa-circle-info" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 32a224 224 0 1 1 0 448 224 224 0 1 1 0-448zm0 480A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM208 352c-8.8 0-16 7.2-16 16s7.2 16 16 16l96 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-32 0 0-112c0-8.8-7.2-16-16-16l-40 0c-8.8 0-16 7.2-16 16s7.2 16 16 16l24 0 0 96-32 0zm48-168a24 24 0 1 0 0-48 24 24 0 1 0 0 48z"></path></svg></div>                    
            <div class="to-info-box-body-content">
              <span>Depending on the distribution, time zone files might be
                located at <b>/usr/lib/zoneinfo</b> .</span>
            </div>
          </div>
        </div>
      </div>
    </td>
    <td>
      <b>ls /usr/share/zoneinfo</b> displays the names for time zones that
      Linux uses. Additional settings are located in the subdirectories.
    </td>
  </tr>
  <tr>
    <td><b>/etc/localtime</b></td>
    <td>
      Identifies the current time zone file used on the system. This file
      is a symbolic link to the appropriate time zone file in the
      <b>/usr/share/zoneinfo</b> directory. Relinking this file to a
      different time zone file changes the system's time zone.
    </td>
    <td>
      <b>ln -s /usr/share/zoneinfo/</b>
      <i>time_zone_file</i>
      <b>/etc/localtime</b> creates a symbolic link to the time zone file
      that permanently alters the time zone for the entire system. <br />
      <b>cp -s /usr/share/zoneinfo/</b>
      <i>time_zone_file</i>
      <b>/etc/localtime</b> accomplishes the same result as the example
      above.
    </td>
  </tr>
  <tr>
    <td><b>/etc/timezone</b></td>
    <td>
      Configures the time zone on Debian-based distributions.
      <b>/etc/timezone</b> identifies the current time zone by region and
      zone.
    </td>
    <td><br /></td>
  </tr>
  <tr>
    <td><b>/etc/sysconfig/clock</b></td>
    <td>
      <p>
        Configures the time zone on some distributions, such as openSUSE.
        The syntax is:
      </p>
      <blockquote>TIMEZONE= <i>"timezone</i> "</blockquote>
    </td>
    <td>TIMEZONE="America/Denver"</td>
  </tr>
  <tr>
    <td><b>date</b></td>
    <td>Used to view and manually set the system time.</td>
    <td><b>date</b> shows the current local time and the time zone.</td>
  </tr>
  <tr>
    <td><b>tzselect</b></td>
    <td>
      Changes the value of the time zone (TZ) environment variable. When
      executed, the utility prompts you to select a region, then a
      country, and so on until it has enough information to determine the
      time zone. Only the root user can invoke the tzselect utility.
      <h2>tzselect</h2>
      <ol>
        <li>Enter <b>tzselect</b> .</li>
        <li>
          Enter the number from the list that corresponds to the correct
          continent or ocean.
        </li>
        <li>
          Enter the number from the list that corresponds to the correct
          region.
        </li>
        <li>
          Enter the number from the list that corresponds to the correct
          timezone.
        </li>
        <li>Press 1 to confirm the setting.</li>
      </ol>
      <div>
        <div>
          <div>
            <div class="to-icon large" aria-hidden="true" style="width: 20px">
              <svg aria-hidden="true" focusable="false" data-prefix="fal" data-icon="circle-info" class="svg-inline--fa fa-circle-info" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 32a224 224 0 1 1 0 448 224 224 0 1 1 0-448zm0 480A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM208 352c-8.8 0-16 7.2-16 16s7.2 16 16 16l96 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-32 0 0-112c0-8.8-7.2-16-16-16l-40 0c-8.8 0-16 7.2-16 16s7.2 16 16 16l24 0 0 96-32 0zm48-168a24 24 0 1 0 0-48 24 24 0 1 0 0 48z"></path></svg></div>                    
            <div class="to-info-box-body-content">
              <span>Use the <b>tzconfig</b> command on Debian-based Linux distributions instead of <b>tzselect</b> .</span>
            </div>
          </div>
        </div>
      </div>
    </td>
    <td><br /></td>
  </tr>
  <tr>
    <td>
      <b>TZ= <i>time_zone</i> <br />export TZ</b>
    </td>
    <td>
      Changes the time zone environment variable. Use the file names in
      the <b>/usr/share/zoneinfo</b> directory to select the appropriate
      names for time zones.
    </td>
    <td>
      TZ='America/Denver'
      <br />
      export TZ
    </td>
  </tr>
  <tr>
    <td><b>timedatectl</b></td>
    <td>
      Can be used to query and change the system clock and its settings.
      With no options, this command lists information on the system’s
      current date and time, as well as time-related settings. A few
      options for this command include:
      <ul>
        <li>
          <b>set-time <i>yyyy/mm/dd hh/mm/ss</i></b>
          changes the date and time according to the parameters entered.
        </li>
        <li>
          <b>list-timezones</b> lists the available time zones recognized
          on your system.
        </li>
        <li>
          <b>set-timezone <i>region/area</i></b> sets the system time zone
          to the specified value.
        </li>
        <li>
          <b>set-local-rtc <i>x</i></b> where x is the value of 0 or 1.
          Configures the real-time clock (RTC) to either maintain the RTC
          in universal time or to maintain the RTC in local time instead.
        </li>
        <li>
          <b>set-ntp <i>true/false</i></b> Controls whether NTP-based
          network time synchronization is enabled.
        </li>
      </ul>
    </td>
    <td>
      <ul>
        <li>
          <b>timedatectl set time "2019-12-02 13:40:15"</b> sets the date
          and time to 2 Dec 2019 and 1:40:15 pm.
        </li>
        <li>
          <b>timedatectl list-timezones</b> shows all the known time zones
          available.
        </li>
        <li>
          <b>timedatectl set-timezone</b> <b>America/Denver</b> changes
          the time zone used by the mountain time zone in the United
          States.
        </li>
        <li>
          <b>timedatectl set-local-rtc 0</b> the value of zero tells the
          system to maintain the RTC in universal time.
        </li>
        <li>
          <b>timedatectl set-ntp true</b> enables NTP-based time
          synchronization.
        </li>
      </ul>
    </td>
  </tr>
</tbody>
</table>

## 10.4.4 Time Maintenance

Click one of the buttons to take you to that part of the video.

Time Maintenance 00:00-00:44
In this lesson, we're going to discuss time maintenance on Linux. When you initially set up a Linux system, you're prompted to configure your system time along with your time zone. When you're working with Linux, it's important that you maintain the correct system time, especially if the system is going to provide network services.

Let's suppose you're running a database server, so you need to make sure that each change that's submitted to the database server from client systems has an accurate time stamp. Problems would arise if database modifications got applied out of sequence because the time stamps are inaccurate.

Using Linux Time Sources 00:44-01:54
Remember, there are two time sources used on a Linux system. The first one is the hardware clock, which is integrated into your system's motherboard and runs all the time, even when the system is powered off.

We also have the system time. This one runs via software inside Linux's kernel, therefore it runs only while the system is up and running. Also, system time is measured not as the current date and time, but as the number of seconds that have elapsed since midnight, January 1st, 1970 UTC.

It's important that you remember that the hardware clock and the system time may not be the same. Therefore, when we're managing a Linux system, we are more concerned about the system time than the time that's currently being reported by the hardware clock.

Really, the role of the hardware clock is simple — to keep time while the system's powered off. When the system gets powered on, the Linux operating system will go out and grab the time from the hardware clock and use that to initially set the system time. Once that's done, Linux cares only about the system time.

Managing the Hardware Clock 01:54-03:32
To manage the hardware clock on your system, use the hwclock command. It can display the current time, set the hardware clock time, or synchronize the hardware clock to the system time or vice versa.

The hardware clock can also be viewed in the file /proc/driver/rtc.

Using the command hwclock or hwclock -r you can see the current hardware time. If you need to update the hardware clock time you can use hwclock --set --date=‘date and time’.

Typically, an administrator does not set the hardware clock manually. If the hardware clock is incorrect and needs to be adjusted, an administrator will set the system time to the correct value, then use hwclock -w (or hwclock --systohc) to push the system time to the hardware clock. The command hwclock -s (or hwclock --hctosys) does the opposite, setting the system time to the value currently used by the hardware clock.

The -l (or --localtime) option and the -u (or --utc) option can be used to specify that the hardware should use the local time or UTC respectively.

Synchronizing Time 03:32-05:18
The scope of the hwclock command's functionality is limited to just your local computer system. If your computer system is operating on a network, then very likely you're going to need the system time on all of your Linux systems to be synchronized.

One tool that you can use is the netdate command, which synchronizes the time on the local system with the time on a time server somewhere on the network. The syntax is shown here. We enter netdate followed by the IP address of the time server.

You could also use the DNS name as well, as long as the specified host is running a time synchronization service.

In this example, I have a time provider on this server. It is listening on port 37 by default. If we run the netdate command on this workstation, it will send the time request to the time provider. The time service hears the request, then sends the appropriate time back to the time consumer over here. At which point, the time on this system is set to whatever time it received from the server system. As a result, the time on these two systems is within a few milliseconds of each other.

It's important that you remember that when you are synchronizing time with the netdate command you are synchronizing system time, not the hardware clock time.

Over time, clocks on computer systems "drift" from each other. A periodic check of time against an authoritative time source is recommended to prevent large gaps in time values on different systems. This is usually done with an NTP-like service, such as ntpd or chrony.

Summary 05:18-05:44
That's it for this lesson. In this lesson, we discussed system time maintenance. We looked at setting of the hardware clock with the hwclock command. We also looked at synchronizing the system time with the netdate command. Maintaining the correct system time is very important on Linux systems, so these commands come in handy.

## 10.4.5 Managing System Time

Click one of the buttons to take you to that part of the video.

Manage System Time 00:00-00:08
In this demonstration, we're going to discuss managing time on a Linux system.

Hardware Clock vs. System Clock 00:08-00:48
As we start our discussion, it's important to understand that, in Linux, there are two types of clocks for determining time: a hardware clock and a system clock. The hardware clock is typically set in the BIOS and is maintained by a battery in your computer. This battery maintains the time when your computer is turned off.

A system clock is a software clock that's maintained by the kernel. When you first turn on your computer, the system clock is set to the same time as the hardware clock. But once that's done, the two clocks run independently of each other. Because of this, if you leave your computer on for too long, it's possible for the two clocks to get out of sync. This is known as clock or time drift. We'll show you how to deal with that a bit later.

View System Time 00:48-02:31
So, how do you view the time on your Linux system? If you're running a GUI version of Linux, most distributions just show the current time somewhere on the screen. For example, on Ubuntu here, you can see the date and time at the top of the screen.

You can also bring up the date and time from the Linux shell prompt with a variety of commands. Since some of the commands I'll be showing you require root privileges, I've already switched over to my root account so that I don't have to use the sudo command.

Okay, so one way to see the current time is by running the date command. This shows the time using a 12-hour clock format. As you can see here, the current time is 12:49 PM. You can also use the timedatectl command. Notice that the time is shown in a 24-hour clock format now and that three different times appear as well.

Our system clock appears as the Local time and as the Universal time. The only difference is that the Universal time is based on Greenwich mean time. In case you don't know what that means, that's just the time it'd be if you were in Greenwich, which is a town in southeast London.

Since my computer is currently set to Mountain Daylight Time, or MDT, this means that my Local time is six hours earlier than Greenwich mean time, as you can see by the -0600 on this line. So while it's 12 hundred hours where I'm located, it's 18 hundred hours in England.

The other time you see is the RTC time. RTC stands for "Real-Time Clock". This is for the hardware clock. When everything is working as it should, the RCT time should match or be very close to the system clock. However, for the purpose of this demonstration, I've turned off the automatic date and time synchronization so it's easier to see how some of the commands work. You'll notice that there's a slight difference between our Local and RTC time.

Set the Day Using the date Command 02:31-02:59
There are several ways to change the date and time, so let's assume that they're incorrect to illustrate. One way is to use the date -s command followed by the correct date. I'll type 2022-10-14 and press Enter to show you. As you can see, the date was changed. And when I run the timedatectl command again, you see that the system clock now thinks it's Friday, but the Real-Time Clock still thinks it's Wednesday. Also notice that since a time wasn't specified when I ran the date command, it was set to zero.

Set the Day Using the timedatectl Command 02:59-03:26
Another way to change the date and time is to use the timedatectl command with the set-time option. This option is then followed by the desired date. Let's set this to July 4, 2023 by entering 2023-07-4 and pressing Enter. In order to see the change, we need to run timedatectl again. Notice that this time, though, the command not only changed the Local and Universal time, but it also changed the RTC time.

Set Time Using NTP 03:26-04:03
Although you can adjust the date and time manually using these and other methods, it's best to use Network Time Protocol, or NTP, to connect a remote time server whenever possible. NTP servers use an atomic clock, so when you sync with them, your time is very accurate. With our date and time all messed up, let's see how this is done.

To turn NTP synchronization on—for this Ubuntu system at least—all I need to do is run timedatectl set-ntp true and press Enter. Now when I run timedatectl again, you see that my system was synchronized with the NTP server, and my date and time are once again correct—as you can see by running date again.

Set Time Using the hwclock Command 04:03-05:34
I want to show you one other command that can be used to help you manage your computer's time, and that's the hwclock command. When you run this command without any options, it grabs the time from the hardware clock. But before displaying anything, it adjusts for the time zone you're in—like in this output here. If you find that your system clock is different from your hardware clock, you can sync them using one of two commands.

To set your system clock the same time as your hardware clock, you'd run hwclock --hctosys. If you wanted to do the opposite and sync your hardware clock to your system clock, you'd run hwclock --systohc. And if you wanted to manually set the time of your hardware clock, you'd use the same basic command you saw with timedatectl—so hwclock --set --date= "2023-07-04 and then the time of 10:00:00". Notice that when I run timedatectl again, only the hardware clock has changed.

Since my system is still running NTP, this change I just made will eventually correct itself. But I can force this to happen more quickly by either rebooting my system or by restarting the time service. I do this by first running systemctl stop systemd-timesyncd to stop time syncing. And then to start the service, I run systemctl start systemd-timesyncd. With that done, when I run timedatectl again, you see that my system is back to its correct time.

Summary 05:34-06:14
That's it for this demonstration. In this demo, we talked about managing time on Linux. First, we discussed the differences between the hardware and system clocks. Then we showed you how to view the times that are associated with both of them.

Next, we showed you how to manually set the date and time using the date command, as well as with the timedatectl command. Then we showed you how both the hardware and system clocks can more easily be kept in sync using a remote NTP server. And we ended this demonstration showing you how to use the hwclock command to manually view and adjust the hardware clock.

## 10.4.6 Time Maintenance Facts

Applications and services require accurate time, especially those used for security purposes.

This lesson covers the following topics:

- General time considerations
- Clock and time files and utilities

### General Time Considerations

Be aware of the following details:

<ul><li>Services that communicate with other computers require that the clocks
        on all the computers are synchronized within a small degree of variance.</li>
   <li>A timestamp is a record attached to an event or an action that
        identifies the time when an event took place. Timestamps are used to:
    <ul><li>Record when security events, such as when login or system changes
            occur.</li>
     <li>Identify the correct sequence of events. For example, if a
            database record is changed from two different computers, the
            timestamp associated with the changes is used to identify which
            change took place first (or last).</li></ul></li></ul>

### Clock and Time Files and Utilities

Use the following files and utilities to manage the hardware clock and system time:

<table>
<thead>
  <tr>
    <th>Command</th>
    <th>Function</th>
    <th>Examples</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td><b>/proc/driver/rtc</b></td>
    <td>Views the hardware clock time.</td>
    <td>
      <b>cat</b> <b>/proc/driver/rtc</b> displays the hardware clock time.
    </td>
  </tr>
  <tr>
    <td><b>hwclock</b></td>
    <td>
      Views and sets the hardware clock time and synchronizes the hardware
      clock and the system time. Options include:
      <ul>
        <li>
          <b>-a, --adjust</b> adds or subtracts time from the hardware
          clock to account for systematic drift since the last time the
          clock was set or adjusted.
        </li>
        <li>
          <b>-r, --show</b> displays the current hardware clock time.
          <b>hwclock</b> assumes <b>-r</b> if no options are used.
        </li>
        <li>
          <b>--set --date=</b> sets the hardware clock time and date.
        </li>
        <li>
          <b>-s, --hctosys</b> sets the system time to the current
          hardware clock time.
        </li>
        <li>
          <b>-w, --systohc</b> sets the hardware clock based on the system
          time.
        </li>
        <li><b>--localtime</b> sets the hardware clock to local time.</li>
        <li><b>-u, --utc</b> sets the hardware clock to UTC time.</li>
      </ul>
    </td>
    <td>
      <b>hwclock -w</b> sets the hardware clock time to match the system
      time. <br />
      <b>hwclock --set --date="2/24/2020 16:45:05" -utc</b> sets the
      hwclock time to 4:45:05 PM on February 24, 2020 on UTC time. <br />
      <b>hwclock -s</b> sets the system time to match the hardware clock.
      <br />
      <b>hwclock -u</b> sets the hardware clock time to UTC time.
    </td>
  </tr>
  <tr>
    <td><b>netdate</b></td>
    <td>
      Sets the system time to match the time on a server running the time
      daemon on the network. The time provider must be running the time
      service on UPD port 37.
    </td>
    <td>
      <b>netdate 192.168.1.10</b> sets the time on the local computer to
      match the time on the time server at 192.168.1.10.
    </td>
  </tr>
  <tr>
    <td><b>date</b></td>
    <td>
      Views and manually sets the system time. Options include:
      <ul>
        <li>
          <b>-d</b> [ <i>date</i> ] displays the date specified by
          <i>date</i> . Use <b>now</b> to display the current date.
        </li>
        <li><b>-s</b> sets the date and time.</li>
        <li><b>-u, --utc</b> specifies UTC time.</li>
      </ul>
    </td>
    <td>
      <b>date -s "11/20/2020 15:48:00"</b> sets the time and date to
      3:48:00 PM on November 20, 2020. <br />
      <b>date -su "11/20/2020 15:48:00"</b> sets the UTC time and date to
      3:48:00 PM on November 20, 2020 <br />
      <b>date -d 01jan2014</b> displays the specified date. <br />
      <b>date -u</b> shows the current UTC time.
    </td>
  </tr>
</tbody>
</table>

## 10.4.7 Network Time Protocol (NTP) Part 1

Click one of the buttons to take you to that part of the video.

Network Time Protocol (NTP) 00:00-01:07
In this lesson, we'll discuss synchronizing time with NTP, or Network Time Protocol. This is currently the best option for synchronizing network time among multiple network hosts. Like netdate, NTP gets its time from a network time provider and sets it to the local system. However, NTP manages time in a much cleaner fashion, making it a better choice in most environments. If there's a big differential between the time provider and your local system, NTP will gradually adjust the time on your local system in small increments until it eventually becomes synchronized.

The netdate command, on the other hand, immediately sets the system time to what it gets from the time provider. In some situations, that works fine. But in others, it can cause problems, resulting in what we call an "unclean" time synchronization. NTP also has wider support by most major computer operating systems. It works on Linux, Windows, Macintosh and so on. So essentially, NTP can synchronize time among all systems in a complex network environment.

NTP Time Synchronization 01:07-01:42
To use NTP, you need to install the NTP daemon, or ntpd. Notice that we use the daemon on both the time provider and the time consumer. That's a very important thing to remember. When you run the NTP daemon, a given system can function as both a time provider and as a time consumer at the same time.

Because of this, the system on the right can get its time from the system on the left. Then some other system somewhere else could get its time from the system on the right because it can function both as a time consumer and as a time provider.

NTP IP Port 123 01:42-02:47
Now, NTP operates over IP port 123. It's an easy port to remember: one, two, three. The NTP daemon on the time consumer sends a time synchronization request to the NTP daemon on the time provider. The time provider then sends its time to the consumer, and the system time on the consumer is adjusted according to the NTP algorithm.

Remember that because of the way NTP works, it doesn't immediately set the local time to that of the provider. Instead, it gradually adjusts it until they both come into synchronization. Also, unlike netdate, syncing doesn't happen with one single command. The NTPD on these two systems communicate back and forth multiple times per day to keep time in sync.

That's another benefit of using ntpd over netdate. Unless you run netdate with a cron job, it never checks to see that the systems are in synchronization again.

Using ntpd, on the other hand, these two systems continually talk to each other preventing drifts from happening. These two systems will stay well synchronized.

NTP Stratum 02:47-04:45
So NTP is a more sophisticated way of synchronizing than the netdate command and the time service. Because of that, there are several key NTP concepts you should be familiar with to effectively implement and manage the NTP protocol on your network.

The first to understand is stratum. NTP uses the concept of stratum to define a hierarchy of servers. At the top of the hierarchy are the Stratum 1 time servers. These servers get their time from a reference time source, such as the Naval Atomic Clock. If you want to learn more about how the Naval Atomic Clock works, visit the URL shown here. In addition to Stratum 1, we also have Stratum 2 time providers. As you can see here, they get their time from a Stratum 1 time provider. And you guessed it, Stratum 3 time providers get their time from a Stratum 2 time provider, not from Stratum 1. We can continue down this NTP stratum to a depth of 256 layers.

Now, Stratum 1 servers aren't publicly available. They're on the internet, but you're not allowed to access them. However, there are a bunch of publicly accessible Stratum 2 NTP time providers online, so you can configure your system to connect to them. If you have just one or two systems on your network, it's not a problem to configure them to get their times directly from a Stratum 2 NTP provider. But if you have a large network, you don't want all your computers to do it this way. You don't want hundreds of computers beating up these Stratum 2 time providers to get the exact same information.

Instead, configure a limited number of systems on your internal network, maybe two or three, to synchronize time with a Stratum 2 time provider on the internet, then configure the rest of your internal systems to get their time from those hosts.

Remember that the NTP daemon allows a system to be both a time consumer, as what happened in this with this arrow, and as a time provider to the other systems, as happens with this arrow.

NTP Concepts 04:45-06:42
A few other concepts to know are stepping and slewing. NTP initially syncs time between the time consumer and time provider about once every minute. However, this interval gradually increases to once every 17 minutes once the time between the two systems is more closely synced. This means that large adjustments occur relatively quickly, and only small adjustments are made across a longer time interval.

So, what are stepping and slewing? Well, if the time difference between the provider and the consumer is small—less than 128 milliseconds, for example—NTP will adjust the time very gradually. This is called slewing. But if the time difference between the provider and consumer is large, it'll make time adjustments a little faster. That's called stepping.

Another concept is insane time. This is one of the worst issues that could occur during an NTP deployment. If the provider and consumer are more than 17 minutes out of sync, NTPD will consider time to be "insane". At that point, it won't adjust anything, and this can cause lots of problems.

I can't tell you how many times I've set up NTP to synchronize two systems and they never did, but I couldn't figure out why. Well, every single time it ended up being because of insane time. So always try to get the times within 17 minutes of each other. Then NTP can start stepping them until they get close and then eventually slewing them to get even closer.

You also need to be familiar with drift. NTP corrects for incidental clock frequency errors, meaning that the time on one system may not run at exactly the same frequency as the time on another system. It's possible for the two to get out of sync, which is why we synchronize with NTP in the first place. And one last concept is jitter. This refers to the time difference between the consumer and the provider since the last time polling.

Summary 06:42-07:11
That's it for this lesson. In this lesson, you learned how to use the NTPD daemon to synchronize time with other systems over a network connection. We looked at the advantages of NTP over netdate and a few basic concepts, such as stratum hierarchy, stepping and slewing, insane time, drift, and jitter. All these concepts will be helpful for the next lesson where we dive deeper into NTPD.

## 10.4.8 Network Time Protocol (NTP) Part 2

Click one of the buttons to take you to that part of the video.

Network Time Protocol (NTP) Part 2 00:00-00:17
In another lesson, we learned some basics about Network Time Protocol, or NTP. With this background in mind, let's discuss how you configure a system to use the NTP protocol to get time from a time provider.

/etc/ntp.conf 00:17-01:38
First, you install the NTP package on your Linux system. Some distributions install it by default, others don't. If yours doesn't have it installed, use yum, zypper, or apt—whichever is appropriate for your distribution—to get it. Then you edit /etc/ntp.conf to configure how NTP works. There are a variety of different parameters within this configuration file, but the key one to be familiar with is server.

The server directive tells the NTP daemon where it's supposed to go to get the time. Enter server, a space, and then the IP address or DNS name of the time provider. It could be another computer on your network. You can also use an NTP pool time server. The pool.ntp.org domain uses a type of DNS round-robin mechanism to make a random selection from a pool of time providers who've volunteered to be in that pool out on the internet. That way, no one public NTP server is overloaded with a whole bunch of different time synchronization requests. It's a good idea to take advantage of this. To do so, add the directive you see here to your ntp.conf file, serverpool.ntp.org. Remember, this URL doesn't point to a server. It points to a pool of servers. You never know which one you'll get, but they're all synchronized so it doesn't matter.

Initial Time Synchronization 01:38-03:19
Here's a critical thing to remember: you must prevent large time jumps. Before you start the NTP daemon, perform a quick one-time synchronization with your NTP time provider. Do this using the ntpdate command because it doesn't work like netdate. It doesn't bring the two systems into direct synchronization. It just gets them close, within that 17-minute window, eliminating large time jumps.

You enter ntpdate, followed by the IP address or DNS name of the time provider you want to get time from. Because ntpdate doesn't immediately synchronize your system with the time provider, you may need to run this command multiple times until you get your system time within that 17-minute window. The further apart the times, the more times you'll need to run this command to get them aligned correctly.

Let's try it. We want to synchronize the local time on the fs5 system with the time on a server that's a member of pool.ntp.org. Looking at the output, you can see how far off we were over here. The time on this system was actually pretty close to the time on the time provider: .002459 seconds off to be exact.

This is pretty much synchronized already. But I should point out that before running the ntpdate command, you need to check whether NTPD—so, the daemon itself—is off. ntpdate won't work while NTPD is running. That's because you'll have two time synchronization mechanisms running simultaneously, and they don't get along with each other. So, shut down ntpd first, and then run ntpdate until you get the time fairly close. Then turn NTPD back on.

Time Monitoring 03:19-06:07
If you're running an older Linux distribution, use the NTPD init script. If you're using a newer Linux distribution based on systemd, use the systemctl command to both enable and start NTPD. This makes sure the NTPD is ready at system boot.

Okay, here it is: system control enable NTPD. Now the NTPD will automatically start whenever the system boots up. Until that happens, the naval command won't start the daemon itself, so you'll have to do that manually. Type system control start NTPD and use the status option to make sure that everything started normally. In this case, you can see that the daemon is active—it's running. So we know that everything's working properly. In fact, if we look down here in the output, we can see the different network interfaces NTPD is using to synchronize time on.

Once the NTPD has been started, there are several commands you can use to monitor how well it's working or how closely its keeping time synchronized. This is the first one. Run ntpq -p at the shell prompt to query the status. The columns and the output include those shown here.

First, there's the remote column, which specifies the hostname or IP address of the time provider. Next is the refid column, which specifies the type of time reference source we're connecting to. The st column specifies the stratum of the time provider. The when column specifies the number of seconds since the last time a poll occurred. The poll column specifies the number of seconds between two polls. The reach column displays whether the time server was reached, the last time it was polled.

A successful poll increments this field by one, so as you can see, these servers were hit 377 times. The delay specifies how much time in milliseconds it took for the time provider to respond to the time request sent from the local system. The offset column specifies the differential between the local system time and the time for the provider. This is in milliseconds as well, not seconds. This confuses a lot of people initially. They see this and think, "Oh, wow! I'm 13 seconds off, or I'm 12 seconds off." No, you're actually 12 or 13 milliseconds off—or whatever it shows here. If that's true, for all intents and purposes, you're synchronized. And then jitter specifies the size of the time discrepancies. Again, this is also measured in milliseconds.

You can use the ntptrace command to monitor the synchronization as well. This utility traces how the time consumer is getting its time from the provider. It specifies the time provider stratum, it lists the offset between the local system and the provider, and so on.

Summary 06:07-06:20
Okay, that's it for part two of this lesson. We discussed how to actually configure NTPD on Linux to get network time.

## 10.4.9 Synchronize Time with NTP

Click one of the buttons to take you to that part of the video.

Synchronize Time with NTP 00:00-00:19
Network Time Protocol, or NTP, is a protocol used to sync time on computers. Any system, regardless of whether it's Linux or Windows, has some form of time synchronization. In this demo, we're going to look at two ways of syncing time on a Linux system.

Install NTP Service 00:19-01:18
The first package we will look at is NTP. This is a legacy service that's being deprecated in newer distributions, such as Red Hat and Ubuntu. To install it, I'm going to first switch to the root user and type apt-get install ntp -y. This installs all the libraries, configs, and daemons needed. On this Ubuntu system, it also starts the NTP service and configures it to run each time the system is started.

To see this, we can run systemctl status ntp. We see that it's running. If NTP isn't automatically activated when you install it, you can run the systemctl start ntp command to initialize the daemon and run the NTP protocol. You also want to run systemctl enable ntp to enable it to run at bootup.

Configure NTP 01:18-02:36
You may want to change the servers in which this system will synchronize its time. To view and edit these settings, let's run nano /etc/ntp.conf.

We see that by default this system is configured to get its time from the Ubuntu NTP pool servers. In most cases, these will work fine. If you want, you can visit this site and locate specific NTP servers closest to you. By scrolling down and selecting this link, I can see the default pools for North America.

If I wanted to get more granular, I could scroll down and select United States. I could then copy and paste these servers into my ntp.conf file. Each server includes the iburst option. This sends a burst of requests to the time server at startup, which usually results in a faster time sync.

We can also add the maxpoll option. I wouldn't set it too low, otherwise you may be blacklisted from the public time servers. Entries like maxpoll 10 would pull NTP messages every 1024 seconds, whereas maxpoll 6 would pull NTP messages every 64 seconds. We're just going to leave the default time servers as they are. Some organizations have specific time server requirements. This is where you'd make those changes.

Access NTP Stats 02:36-03:20
Earlier when we checked the daemon's status using the systemctl status ntp command, we saw that NTP was running, but we didn't see much information related to time sync.

To query for NTP-related info, let's run ntpq -p. This command prints a list of peers and their states. When you see the servers you're syncing against, they're not always the same as the servers specified in your config file. This is OK. When you sync against a DNS name with the word "pool", it means that there's a pool of servers under that name. This and other commands related to ntpq can be found in the man page by typing man ntpq.

Decipher NTP Stats 03:20-03:48
Let's run ntpq again and explain a few of the stats listed. Most of these measurements are in milliseconds, so items such as delay is the round trip delay it takes or latency of the time packets. The offset refers to the difference in time between the localhost and the time server. Lastly, jitter is the variance in time between the localhost and the time server. The lower the jitter, the better. Okay, now let's look at another service used for NTP.

Chrony Service 03:48-05:19
Chrony is a newer implementation of the NTP protocol. Chrony performs better in a congested network, and it can synchronize the clock quicker and with better accuracy.

Keep in mind that you can't use both packages at the same time. If you were using the NTP service prior to this, you'd want to uninstall it first and then install Chrony. To install Chrony, you type apt install chrony -y.

Once installed, we can run systemctl status chrony to verify that the service is running. You can run the systemctl start chrony and systemctl enable chrony commands if you need.

The configuration for this service is similar to earlier. We run nano /etc/chrony/chrony.conf. You can see the time server pools that Ubuntu uses. Just like the NTP package, if you had your own NTP servers, you could use those or change to some internet time server pools.

The iburst option still applies. But there is also a new option name maxsources. This option sets the desired number of sources to be used from the pool. Chronyd will repeatedly try to resolve the name until it gets this number of sources responding to requests. The default value is 4 and the maximum value is 16. Let's keep the defaults an exit this file now.

View Chrony Stats 05:19-07:03
There are several commands that can be used to view how Chrony is functioning. The first is chronyc sources. This command shows all the current NTP servers you're syncing against. They may vary, as you're pulling from a pool of internet time servers that might not always be the same.

Another good command is chronyc sourcestats. This command provides you with more statistics related to each time server. You'll notice some stats are similar, but the stats from Chrony provide a more granular detail.

A good reference is to look at the man page. When you type a forward slash and then sourcestats, you can look at the details related to the command we just ran. These pages are very descriptive and explain what you may be looking for. Okay, let's exit this.

Now let's check our time sync again by running chronyc sources again. The Reach column shows the source's reachability register printed as an octal number. It's updated on every received or missed packet from the source. When a value of 377 is shown, it indicates that a valid reply was received for all from the last eight transmissions.

The characters off to the left-hand side of the time servers serve a purpose by giving you certain details. For example, the time server with an \* indicates the source to which chronyd is currently synchronized.

A + sign indicates acceptable sources which are combined with the selected source. And the – sign indicates acceptable sources which are excluded by the combining algorithm. There are a few other characters, such as the x and ~ that aren't currently being shown, but you can learn about those in the man pages.

Firewall Rules 07:03-07:16
After setting up either the NTP service or Chrony, make sure that there are no firewall rules restricting the use of UDP port 123. Generally, outbound system firewall traffic isn't blocked by default.

Summary 07:16-07:30
Okay, and that's it for the demo. In this demonstration, we showed you two different NTP protocol services and details related to time sync in Linux.

## 10.4.10 NTP Facts

The Network Time Protocol (NTP) is used to synchronize system time between computers over a network connection.

This lesson covers the following topics:

<ul><li>How NTP works</li>
<li>NTP files and utilities</li>
<li>General considerations</li></ul>

### How NTP Works

NTP uses a hierarchy of clocks and computers for synchronizing the current time. NTP:

<ul>
<li>Gradually synchronizes time in increments.</li>
<li>
  Allows computers to be a time consumer and a time provider
  simultaneously, allowing computers to synchronize time hierarchically.
</li>
<li>Runs on IP port 123.</li>
<li>
  Uses strata to define time providers in a hierarchy (levels of time
  providers):
  <ul>
    <li>
      Stratum 0 devices are accurate clocks (such as atomic clocks) that
      provide the official UTC time.
    </li>
    <li>Stratum 1 devices get their time from stratum 0 devices.</li>
    <li>
      Stratum 2 devices receive their time from stratum 1 devices and can
      also provide time to other devices.
    </li>
  </ul>
</li>
<li>
  Supports up to 256 strata, with lower devices getting time from higher
  devices and providing time to devices in a lower stratum.
</li>
<li>
  Can be configured to use a pool of time server at
  <b class="fw-bold">pool.ntp.org</b> .
</li>
<li>
  Uses stepping to quickly make large adjustments to close wide time
  discrepancies, usually about once every 60 seconds.
</li>
<li>
  Uses slewing to make smaller incremental time adjustments at a rate of
  about every 15 - 17 minutes. Slewing occurs when time discrepancies are
  under 128ms.
</li>
<li>
  Does not adjust time when time discrepancies are larger than 17 minutes.
  This is known as insane time.
</li>
<li>
  Logs time synchronization events in:
  <ul>
    <li>
      The <b class="fw-bold">/var/log/ntp</b> file on init-based
      distributions.
    </li>
    <li>The system journal on systemd distributions.</li>
  </ul>
</li>
</ul>

### NTP Files and Utilities

Use the following files and utilities to manage time using the NTP:

<table>
<thead>
  <tr>
    <th>Command or File</th>
    <th>Function</th>
    <th>Examples</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td><b>/etc/ntp.conf</b></td>
    <td>
      Configures the time providers where the ntpd daemon should get its
      time from.
      <ul>
        <li>
          Each entry in the file begins with
          <b>server <strong></strong></b> , followed by the address of the
          time provider.
        </li>
        <li>
          The <b>server 127.127.1.0</b> entry identifies the local host
          address and sets the system time to the hardware clock if no
          other time providers are available.
        </li>
      </ul>
    </td>
    <td>
      <b>server 0.fedora.pool.ntp.org</b> synchronizes the time with the
      Fedora time server pool. <br />
      <b>server 192.168.1.10</b> synchronizes the time with a computer at
      the specified IP address. <br />
      <b>server 127.127.1.0</b> synchronizes the time with the hardware
      clock on the local computer.
    </td>
  </tr>
  <tr>
    <td><b>ntpdate</b></td>
    <td>
      Updates the current time on a computer. <b>ntpdate</b> must be run
      as root; it will not function if the ntpd daemon is currently
      running.
      <div>
        <div>
          <div>
            <div class="to-icon large" aria-hidden="true" style="width: 20px">
              <svg aria-hidden="true" focusable="false" data-prefix="fal" data-icon="circle-info" class="svg-inline--fa fa-circle-info" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 32a224 224 0 1 1 0 448 224 224 0 1 1 0-448zm0 480A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM208 352c-8.8 0-16 7.2-16 16s7.2 16 16 16l96 0c8.8 0 16-7.2 16-16s-7.2-16-16-16l-32 0 0-112c0-8.8-7.2-16-16-16l-40 0c-8.8 0-16 7.2-16 16s7.2 16 16 16l24 0 0 96-32 0zm48-168a24 24 0 1 0 0-48 24 24 0 1 0 0 48z"></path></svg></div>                    
            <div class="to-info-box-body-content">
              <span><b>ntpdate</b> is deprecated; use <b>ntpd</b> in itsplace.</span>
            </div>
          </div>
        </div>
      </div>
    </td>
    <td>
      <b>ntpdate 0.pool.ntp.org</b> updates the system time using a time
      provider from the NTP pool.
    </td>
  </tr>
  <tr>
    <td><b>ntpd</b></td>
    <td>
      Manages the NTP daemon from the command line. Options include:
      <ul>
        <li>
          <b>-q</b> does a one-time synchronization with a time provider.
          It is similar to <b>ntpdate</b> .
        </li>
        <li>
          <b>-g</b> allows the NTP daemon to ignore insane time
          restrictions for the first synchronization.
        </li>
        <li>
          <b>-c</b>
          <span lang="EN">specifies the name and path of the configuration file. The default is <b>/etc/ntp.conf</b> .</span>
        </li>
      </ul>
    </td>
    <td>
      <b>ntpd -qg</b> updates the current time on the computer and ignores
      insane time restrictions. <br />
      <b>ntpd -c ~/ntp/ntpconfig.txt</b> changes the configuration file
      that NTP uses to <i class="fs-italicize">~/ntp/ntpconfig.txt</i> .
    </td>
  </tr>
  <tr>
    <td>
      <b>rcntp start</b> (init) <b><br /></b> or <br />
      <b>systemctl start ntpd</b> (systemd)
    </td>
    <td>Starts the NTP daemon.</td>
    <td><b>systemctl start ntpd</b> starts the NTP daemon.</td>
  </tr>
  <tr>
    <td>
      <b>insserv ntp</b> (init)
      <br />
      or
      <br />
      <b>systemctl enable ntpd</b> (systemd)
    </td>
    <td>
      Configures the NTP daemon to start at boot time (BSD systems only.)
    </td>
    <td>
      <b>systemctl enable ntpd</b> starts the NTP daemon automatically on
      system boot.
    </td>
  </tr>
  <tr>
    <td><b>ntpq -p</b></td>
    <td>
      Queries the status of the NTP daemon. The output displays the
      following information for each time provider:
      <ul>
        <li>
          <b>remote</b> specifies the IP address of the current time
          provider.
        </li>
        <li><b>refid</b> specifies the type of the time provider.</li>
        <li><b>st</b> shows the stratum of the time provider.</li>
        <li><b>when</b> shows the last synchronization time.</li>
        <li><b>poll</b> shows the synchronization interval.</li>
        <li>
          <b>reach</b> lists the last time NTP queried the time provider.
        </li>
        <li>
          <b>delay</b> displays the network lag time between the time
          provider and the client (in milliseconds).
        </li>
        <li>
          <b>offset</b> specifies the time difference between the local
          system clock and the time provider (in milliseconds).
        </li>
        <li>
          <b>jitter</b> specifies the size of time discrepancies (in
          milliseconds).
        </li>
      </ul>
    </td>
    <td><b>ntpq -p</b> displays the status of the ntpd daemon.</td>
  </tr>
  <tr>
    <td><b>ntptrace</b></td>
    <td>
      Traces how the time consumer receives time from the provider. It
      lists the time provider's name, its stratum, and its time offset
      from the system clock on the local system.
    </td>
    <td>
      <b>ntptrace</b> traces how the time consumer is receiving time from
      the provider.
    </td>
  </tr>
</tbody>
</table>

### General Considerations

Keep the following in mind when working with NTP:

<ul><li>To view events as the NTP daemon starts:
    <ul><li>Use one terminal to start the daemon, and use another terminal
            with the <b class="fw-bold">tail</b> command to view the daemon log at <b class="fw-bold">/var/log/ntp</b> on init-based distributions.</li>
     <li>Use one terminal to start the daemon, and use another terminal
            with the <b class="fw-bold">journalctl -f</b> command running on systemd-based
            distributions.</li></ul></li>
   <li>The time used by the computer is adjusted to account for network delay
        and other inaccuracies detected in the received time. The amount of
        error that the algorithm identifies is called the drift. The drift is
        calculated over time and typically saved on the computer to quickly
        identify accurate time, compensated by the drift amount.</li>
   <li>The computer continues to poll the time servers to ensure that the
        system time remains synchronized.</li>
   <li>If configuration changes are made to the <b class="fw-bold">/etc/ntp.conf</b> file,
        those changes won't take effect until the NTP daemon is restarted using
        the <b class="fw-bold">systemctl restart ntpd</b> command.</li></ul>
